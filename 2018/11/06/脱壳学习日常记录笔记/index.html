<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="敬畏之心">
  <meta name="description" content="学习代码之路">
  
  <title>慕斯抗真菌</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<link rel="shortcut icon" href="/source/favicon.ico">
</head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/header-bg.png);background-color:#00e699">
    <div class="header-box"><img src="/images/明石.jpg" ondragstart="return false;"></div>
    <p></p>
    <div class="nav-link">
        
        <a href="http://example.com" target="_blank"> <div class="link-box twitter"></div></a>
        
        
        <a href="https://github.com/mskzj" target="_blank"><div class="link-box github"></div></a>
        
        
        <a href="mailto:mskzj123456@163.com"><div class="link-box email"></div></a>
        
        
        <a href="http://example.com" target="_blank"><div class="link-box weibo"></div></a>
        
        
        <a href="https://www.zhihu.com/people/mu-si-kang-lan-zao/activities" target="_blank"> <div class="link-box zhihu"></div></a>
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class='no-result'>无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2018/11/">November 2018<span class="archive-count">4</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/09/">September 2018<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/05/">May 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/04/">April 2018<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/03/">March 2018<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/02/">February 2018<span class="archive-count">1</span></a>
    </li>
</ul>
<!--categories-->

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/web学习/">web学习<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/web安全/">web安全<span class="category-count">6</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/生活/">生活<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/编程/">编程<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/逆向/">逆向<span class="category-count">1</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>标签</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<!--about-->


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#00e699;background-image:url(/images/random/vateral-6.png)" >
  <h2>脱壳学习日常记录笔记</h2>
    
  <p>作者: &nbsp&nbsp 发布于:<time datetime="2018-11-06T09:17:34.000Z">
          2018-11-06
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <h2 id="2018-11-6之前的笔记"><a href="#2018-11-6之前的笔记" class="headerlink" title="2018/11/6之前的笔记"></a>2018/11/6之前的笔记</h2><p>单步跟踪法—-凭毅力和信心找oep</p>
<p>ESP定律法利用堆栈平衡——有入栈有出栈</p>
<h2 id="2018-11-6"><a href="#2018-11-6" class="headerlink" title="2018/11/6"></a>2018/11/6</h2><h4 id="手脱fsg壳"><a href="#手脱fsg壳" class="headerlink" title="手脱fsg壳"></a>手脱fsg壳</h4><p><strong>1.找oep</strong></p>
<p><strong>脱壳新方法</strong>—特殊ESP定律法：<br>（FSG 2.0 -&gt; bart/xt）<br>单步到push ebp前一步，堆栈第四行（固定位置）即为程序入口地址，再反汇编窗口跟随第四行地址下硬件执行端点点击执行，跳到oep</p>
<p><strong>2.修复</strong></p>
<p>背景–当使用importREC自动查找IAT转存文件不能运行时(IAT有：OEP，RVA，SIZE )<br>手动查找IAT：</p>
<p>1.oep为程序入口。</p>
<p>2.找到有可以某个call函数的rva地址，数据窗口跟随往前翻直到无存储数据的地址为要找的开始的RVA地址，往下翻到无存储数据的地址为结束相应的RVA地址，二者相减为size 。也可手动设置size为一个较大数然后将再无效函数中剪切指针。</p>
<p>3.转存文件</p>
<h4 id="手脱PECompact2-X"><a href="#手脱PECompact2-X" class="headerlink" title="手脱PECompact2.X"></a>手脱PECompact2.X</h4><p><strong>脱壳新方法</strong></p>
<p>直接下断点BP VirtualFree：</p>
<p>方式1：SHIFT+F9（忽略异常运行   ，取消断点 ）;ALT+F9（ 返回到用户代码段，运行至上层调用的下句）;查找 push 8000(特征码)运行到这单步跟</p>
<p>方式2：两次SHIFT+F9中断后取消断点，Alt+F9返回单步走。</p>
<p>后一次异常法：<br>取消所有异常。记录多少次跑飞。找最后一次的前一次的SE句柄转到SE xxxx处，下断点运行。</p>
<h2 id="2018-11-13"><a href="#2018-11-13" class="headerlink" title="2018/11/13"></a>2018/11/13</h2><p><strong>新修复方法：</strong>当遇到脱壳完不能运行而且用imprec也修复不了时可以用lord_pe的重建pe法修复打入需要修复的文件试试</p>
<p><strong>新方法—模拟跟踪法：</strong>先用最后一次异常法到SE句柄处下端运行到后，在M窗口找到sfx输入表位置跟踪</p>
<p><code>tc eip&lt;输入表位置</code></p>
<p>然后直接到oep</p>
<h4 id="手脱TELock0-98b1壳"><a href="#手脱TELock0-98b1壳" class="headerlink" title="手脱TELock0.98b1壳"></a>手脱TELock0.98b1壳</h4><p><strong>新修复方法：</strong>当所有的已知方法都死活都不能修复文件的时候，并且有很多无效指针时。使用IR中的trace跟踪无效的指针然后经行修复（这个有多种选择，一是根据trace等级，二是根据每个壳查壳后的特性）</p>
<p>emmmmmmm，这里比较坑的一点是使用od的时候无法直接跟踪无效指针进行修复。需要在运行程序后进行跟踪。</p>
<h2 id="2018-11-14"><a href="#2018-11-14" class="headerlink" title="2018/11/14"></a>2018/11/14</h2><h4 id="手脱exe32pack壳"><a href="#手脱exe32pack壳" class="headerlink" title="手脱exe32pack壳"></a>手脱exe32pack壳</h4><p><strong>新方法</strong>—–下断点BP IsDebuggerPresent 运行，取消断点，执行到用户代码ALT+F9，计算此时的ss+edi为OEP！</p>
<h2 id="2018-11-16"><a href="#2018-11-16" class="headerlink" title="2018/11/16"></a>2018/11/16</h2><h4 id="软件绿化"><a href="#软件绿化" class="headerlink" title="软件绿化"></a>软件绿化</h4><p>开始实战去广告啦！（练习的为吾爱破解网的官方教程）<br>当然去广告之前还是要先脱壳。能修改的都是脱过壳的程序</p>
<p>四种常见的弹窗口API</p>
<table>
<thead>
<tr>
<th style="text-align:left">API名</th>
<th style="text-align:center">弹窗原理</th>
<th style="text-align:center">OD堆栈窗口表示</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>1.MessageBoxA/W</strong></td>
<td style="text-align:center">消息框</td>
<td style="text-align:center">MessageBoxA/W</td>
</tr>
<tr>
<td style="text-align:left"><strong>2.ShellExecuteA/W</strong></td>
<td style="text-align:center">控制台执行</td>
<td style="text-align:center">open url</td>
</tr>
<tr>
<td style="text-align:left"><strong>3.WinExec</strong></td>
<td style="text-align:center">Windows执行</td>
<td style="text-align:center">explorer.exe url</td>
</tr>
<tr>
<td style="text-align:left"><strong>4.CreateProcessA/W</strong></td>
<td style="text-align:center">创建进程IE</td>
<td style="text-align:center">PATH url</td>
</tr>
</tbody>
</table>
<p>其中第一个是弹消息框，其余为弹网页</p>
<p><strong>去除这些API方法：</strong></p>
<p>法1： 跟随表达式下断点，运行此处，然后在堆栈窗口第一条回车找到push的参数，然后进行nop填充</p>
<p>法2：找到这些网页的网址经行00填充</p>
<p>去除方法的原理很简单就是将参数置为00或指令变为NOP。但是由于有些网址有加密所以不能直接找到对应的网址。</p>
<p><strong>注意参数的个数和push相对应</strong></p>

  </div>
  <!--评论块-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2018/11/08/无字母数字payload简单脚本和原理/" id="post_nav-newer" class="post-nav-content prev-content">
      新篇
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2018/09/23/tcp，udp简单编程/" id="post_nav-older" class="post-nav-content next-content">
      旧篇
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2018-11-6之前的笔记"><span class="post-toc-number">1.</span> <span class="post-toc-text">2018/11/6之前的笔记</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2018-11-6"><span class="post-toc-number">2.</span> <span class="post-toc-text">2018/11/6</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手脱fsg壳"><span class="post-toc-number">2.0.1.</span> <span class="post-toc-text">手脱fsg壳</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手脱PECompact2-X"><span class="post-toc-number">2.0.2.</span> <span class="post-toc-text">手脱PECompact2.X</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2018-11-13"><span class="post-toc-number">3.</span> <span class="post-toc-text">2018/11/13</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手脱TELock0-98b1壳"><span class="post-toc-number">3.0.1.</span> <span class="post-toc-text">手脱TELock0.98b1壳</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2018-11-14"><span class="post-toc-number">4.</span> <span class="post-toc-text">2018/11/14</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#手脱exe32pack壳"><span class="post-toc-number">4.0.1.</span> <span class="post-toc-text">手脱exe32pack壳</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2018-11-16"><span class="post-toc-number">5.</span> <span class="post-toc-text">2018/11/16</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#软件绿化"><span class="post-toc-number">5.0.1.</span> <span class="post-toc-text">软件绿化</span></a></li></ol></li></ol></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#00e699"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright ©  2018  慕斯抗真菌</p>
<p style="font-size: 10px" id="footer-times" data-time="4/4/2018"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//初始日期
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
    show_date_time();
</script>

  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
